{% extends 'products/base.html' %}

{% block content %}

<br> <br>

<!-- Search form -->
<form action="{% url 'search_products' %}" method="get" class="search-form">
    <input type="search" name="q" placeholder="Поиск по названию товара" value="{{ request.GET.q }}" class="form-control">
    <button type="submit" class="btn btn-primary">Искать</button>
</form>

<!-- Filter form -->
<form action="{% url 'filter_products' %}" method="get" class="filter-form">
    <label for="price_min" class="label">Цена от:</label>
    <input type="number" name="price_min" id="price_min" value="{{ request.GET.price_min }}" class="form-control">
    <label for="price_max" class="label">до:</label>
    <input type="number" name="price_max" id="price_max" value="{{ request.GET.price_max }}" class="form-control">
    BYN
    <br> <br>
    <label for="product_type" class="label">Тип товара:</label>
    <select name="product_type" id="product_type" class="form-control">
        <option value="">Все</option>
        {% for type in product_types %}
            <option value="{{ type }}" {% if request.GET.product_type == type %}selected{% endif %}>{{ type }}</option>
        {% endfor %}
    </select>
    <button type="submit" class="btn btn-primary">Фильтровать</button>
</form>

<!-- User menu -->
{% if request.user.is_authenticated %}
<div class="user-menu" style="float: right; margin-top: -20px;">
    <p>Здравствуйте, {{ request.user.username }}!</p>
    <div class="menu-links">
        {% if request.user.is_staff and not request.user.is_superuser %}
            <a href="{% url 'employee_dashboard' %}" class="btn btn-primary">Панель сотрудника</a>
        {% endif %}
        {% if request.user.is_superuser %}
            <a href="{% url 'employee_register' %}" class="btn btn-primary">Регистрация сотрудника</a>
            <a href="{% url 'admin_dashboard' %}" class="btn btn-primary">Административная панель</a>
        {% endif %}
        {% if not request.user.is_staff and not request.user.is_superuser %}
            <a href="{% url 'orders' %}" class="btn btn-primary">Мои заказы</a>
        {% endif %}
        <a href="{% url 'quote_of_the_day' %}" class="btn btn-primary">Цитата дня</a>
        <a href="{% url 'person_gender' %}" class="btn btn-primary">Пол по имени</a>
    </div>
</div>
{% endif %}

<!-- Product list -->
<p>
    <a href="{% url 'products_list' %}" class="btn btn-primary">Все товары</a>
    <a href="{% url 'product_types_list' %}" class="btn btn-primary">Типы товаров</a>
</p>

{% if products %}
<table class="product-list">
    <tr>
    {% for product in products %}
        <td style="width: 40%; vertical-align: top;">
            <h2><a href="{% url 'product_detail' product.id %}">{{ product.name }}</a></h2>
            <img src="{{ product.image.url }}" alt="{{ product.name }}" style="width: 150px; height: 150px;">
            <p>Код: {{ product.code }}</p>
            <p>Тип: {{ product.product_type }}</p>
            <p>Модель: {{ product.model }}</p>
            <p>Цена: {{ product.price }}</p>
            {% if request.user.is_authenticated and not request.user.is_staff and not request.user.is_superuser %}
                <a href="{% url 'create_order' product.id %}" class="btn btn-primary">Заказать</a>
            {% endif %}
        </td>
        {% if forloop.counter|divisibleby:4 %}
            </tr><tr>
        {% endif %}
    {% endfor %}
    </tr>
</table>
{% else %}
    <p>Товары не найдены.</p>
{% endif %}

<!-- Calendar -->
<h2>Календарь</h2>
<pre>{{ calendar }}</pre>

<style>
    .search-form {
        margin-bottom: 20px;
    }
    .filter-form {
        margin-bottom: 20px;
    }
    .user-menu {
        background-color: #f0f0f0;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
    }
    .menu-links {
        display: flex;
        flex-direction: column;
    }
    .menu-links a {
        margin-bottom: 10px;
    }
    .product-list {
        border-collapse: collapse;
    }
    .product-list td {
        border: 1px solid #ddd;
        padding: 10px;
    }
    .product-list img {
        margin-bottom: 10px;
    }
</style>

{% endblock %}